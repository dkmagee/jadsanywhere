(function(a){a.jADSAnywhere=function(c,e,b){var d=this;d.$el=a(c);d.el=c;d.adsBaseURL="http://adsabs.harvard.edu/cgi-bin/nph-abs_connect?type=XML&data_type=XML&start_nr=1";d.yqlBaseURL="http://query.yahooapis.com/v1/public/yql";d.yqlBaseQuery="select record from xml where url=";d.$el.data("adsQuery",d);d.init=function(){if(typeof(e)==="undefined"||e===null){e=""}d.query=e;d.options=a.extend({},a.jADSAnywhere.defaultOptions,b);d.buildLoader();if(d.options.privateLib){d.adsURL=d.adsBaseURL+"&library&libid="+d.query+"&libname="+d.options.privateLibName.replace(/ /g,"+")+"&nr_to_return="+d.options.limit}else{d.adsURL=d.adsBaseURL+"&author="+encodeURIComponent(d.query)+"&nr_to_return="+d.options.limit+"&qform=AST";if(d.options.astroDB){d.adsURL+="&db_key=AST"}if(d.options.physicsDB){d.adsURL+="&db_key=PHY"}if(d.options.arxivDB){d.adsURL+="&db_key=PRE"}}if(d.options.pubYearStart){d.adsURL+="&start_year="+d.options.pubYearStart}if(d.options.pubYearEnd){d.adsURL+="&end_year="+d.options.pubYearEnd}d.yqlQuery={q:d.yqlBaseQuery+'"'+d.adsURL+'"',format:"json"};a.ajax({url:d.yqlBaseURL,data:d.yqlQuery,dataType:"jsonp",jsonp:"callback",jsonpCallback:"adsCallback"})};d.buildLoader=function(){d.$loader=a('<div id="loading">Loading publications from ADS...</div>');d.$loader.css({display:"none","text-align":"center","z-index":5000,position:"fixed",left:"40%",bottom:"40%",padding:"10px","background-color":"#000",opacity:0.8,color:"#fff","-moz-border-radius":"10px","-webkit-border-radius":"10px","border-radius":"10px"});d.$loader.appendTo(d.$el).hide();d.$loader.ajaxStart(function(){a(this).fadeIn(500)})};d.formatRecord=function(g){var f="<h5>"+g.pubdate+"</h5><h3>"+g.title+"</h3><p>"+g.authors+"</p><blockquote>"+g.abs+"</blockquote><p>"+g.journal+' <a href="'+g.url+'">View ADS page</a></p>';return f};adsCallback=function(f){a.each(f.query.results.records,function(h,j){var g={};a.each(j.record,function(i){var k=j.record[i];if(typeof(k)==="object"){if(i==="author"){g.authors=k.join(", ")}if(i==="keywords"){g.keywords=(typeof(k.keyword)==="object")?k.keyword.join(", "):k.keyword}if(i==="link"){g.links={};a.each(k,function(n){var m=k[n];if(m.type){var o=m.type.toLowerCase();if(o==="abstract"){o="abs"}g.links[o]={name:m.name,url:m.url}}})}}else{if(i==="author"){g.authors=k}else{if(i==="abstract"){g.abs=k}else{g[i]=k}}}});d.$el.append(d.formatRecord(g))});d.$loader.fadeOut(500)};d.init()};a.jADSAnywhere.defaultOptions={limit:20,privateLib:false,privateLibName:null,astroDB:true,physicsDB:true,arxivDB:true,pubYearStart:null,pubYearEnd:null};a.fn.jADSAnywhere=function(c,b){return this.each(function(d){(new a.jADSAnywhere(this,c,b))})}})(jQuery);